{% extends 'ccis/base.html' %}
{% load static %}

{% block conteudo %}

<div class="container-fluid scrollable-content">

    <div class="row mt-2">

        <!-- Menu -------------------------------->
        <div class="col-1 menu-request p-2">
            <h6 style="text-align: center;" class="pt-3 pb-2">FILTRO</h6>
            <!--Botões----------------------->
            <ul class="ul-novo-solicit mt-3 ">
                <li class="li-novo-solicit">
                    <a href="" class="link-solicit">
                        Todos
                    </a>
                </li>

                <li class="li-novo-solicit">
                    <a href="" class="link-solicit">
                        Abertos
                    </a>
                </li>

                <li class="li-novo-solicit">
                    <a href="" class="link-solicit">
                        Fechados
                    </a>
                </li>

                <li class="li-novo-solicit">
                    <a href="" class="link-solicit">
                        Concluído
                    </a>
                </li>
            </ul>
            <!--Botões end----------------------->
        </div>
        <!-- Menu -------------------------------->

        <!--Solicitações--------------------->
        <div class="col-3 menu-request p-0">
            <h6 class="pt-4 ps-2">SOLICITAÇÕES</h6>

            {% for card in cards %}
            <!--bottons solicit--------------------->
            <div class="mt-4">
                <a href="" class="list-group-item list-group-item-action" aria-current="true"
                   data-card-id="{{ card.id }}">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-2">{{ card.assunto }} / {{ card.service }} </h6>
                        <div class="" style="font-size: 13px;">
                            {{ card.dataCriacao|timesince }} Atrás
                        </div>
                    </div>

                    <small class="mb-2">Departamento {{ card.cardsetorhistory_set.first.setor_atual }}</small>
                </a>
            </div>
            <!--bottons solicit end--------------------->
            {% endfor %}

        </div>
        <!--Solicitações--------------------->

        <!--Campo de Formulário--------------------->
        <div class="col menu-request ">
            <h6 style="border-bottom: 1px solid #ccc; padding-bottom: 23px;">{{ card.assunto }} /
                {{ card.service }}</h6>
            <div id="formulario-content">


            </div>
        </div>
        <!--Campo de Formulário--------------------->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function () {
    $(".list-group-item").click(function (event) {
        event.preventDefault();
        var cardId = $(this).data("card-id");

        $.ajax({
            url: "/get_card_details/",
            type: "GET",
            data: { card_id: cardId },
            success: function (data) {
                console.log(data); // Adicione esta linha para depuração
                var content = '<h6>' + data.assunto + ' / ' + data.service + '</h6>';
                content += '<small>Departamento ' + data.setor_atual + '</small>';
                // Adicione outros detalhes conforme necessário
                $("#formulario-content").html(content);
            },
            error: function () {
                alert("Erro ao buscar os detalhes do cartão.");
            }
        });
    });
});
</script>



{% endblock %}